<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Real Spatial Vault</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #050505; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; }
        .vault-status { border: 2px solid var(--neon); padding: 20px; border-radius: 15px; margin: 20px auto; max-width: 500px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; background: #111; border: 1px solid var(--neon); color: white; border-radius: 5px; }
        button { background: var(--neon); color: black; border: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; }
        .success { color: #00ff88; font-weight: bold; }
    </style>
</head>
<body>

    <h1>القبو المكاني الحقيقي (Spatial Vault)</h1>
    
    <div class="vault-status">
        <div id="gps-info">جاري تحديد موقعك بدقة...</div>
        <hr border="0.5" color="#222">
        
        <h3>إيداع سر جديد</h3>
        <textarea id="secretInput" placeholder="اكتب سرك هنا (كلمة سر محفظة، كود، إلخ)"></textarea>
        <button onclick="lockSecret()">تشفير السر بموقعي الحالي</button>
        
        <hr border="0.5" color="#222">
        
        <h3>فك التشفير</h3>
        <p id="encryptedDisplay" style="word-break: break-all; font-size: 10px; color: #666;"></p>
        <button onclick="unlockSecret()" style="background: #555; color: white;">حاول الفتح من موقعك الحالي</button>
        <h2 id="result"></h2>
    </div>

    <script>
        let savedLat, savedLon, encryptedData;

        // جلب الموقع الحقيقي بدقة عالية
        function getLocation() {
            navigator.geolocation.watchPosition((p) => {
                savedLat = p.coords.latitude.toFixed(6);
                savedLon = p.coords.longitude.toFixed(6);
                document.getElementById('gps-info').innerText = `الموقع الحالي المعتمد: ${savedLat} , ${savedLon}`;
            }, null, {enableHighAccuracy: true});
        }

        // تشفير حقيقي: الموقع هو المفتاح
        function lockSecret() {
            const secret = document.getElementById('secretInput').value;
            if(!secret) return alert("اكتب شيئاً أولاً!");
            
            const key = savedLat + savedLon; // المفتاح هو إحداثياتك اللحظية
            encryptedData = CryptoJS.AES.encrypt(secret, key).toString();
            
            document.getElementById('encryptedDisplay').innerText = "تم التشفير: " + encryptedData;
            document.getElementById('secretInput').value = "";
            alert("تم قفل السر جغرافياً بنجاح!");
        }

        // فك تشفير حقيقي: لن يعمل إلا في نفس النقطة
        function unlockSecret() {
            if(!encryptedData) return alert("لا يوجد بيانات مشفرة!");
            
            const key = savedLat + savedLon;
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedData, key);
                const originalText = bytes.toString(CryptoJS.enc.Utf8);
                
                if (originalText) {
                    document.getElementById('result').innerText = "تم الفتح: " + originalText;
                    document.getElementById('result').className = "success";
                } else {
                    throw new Error();
                }
            } catch (e) {
                alert("فشل فك التشفير! أنت لست في الموقع الدقيق (الإحداثيات غير متطابقة).");
            }
        }

        getLocation();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Data Link - Cross Platform</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --primary-neon: #00f2ff;
            --bg-dark: #02060a;
            --panel-bg: rgba(10, 20, 30, 0.9);
        }

        /* تصفير الإعدادات لضمان التوافق مع كل المتصفحات */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html { 
            height: 100%; 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg-dark); 
            color: white; 
            overflow: hidden;
        }

        /* الخريطة تأخذ كامل الشاشة */
        #map { 
            position: absolute; 
            top: 0; bottom: 0; left: 0; right: 0; 
            z-index: 1; 
            background: var(--bg-dark);
        }

        /* الواجهة العلوية - متجاوبة */
        .header-ui {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .main-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); /* لدعم متصفح Safari */
            border: 1px solid rgba(0, 242, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            pointer-events: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
        }

        input, button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            border: 1px solid rgba(0, 242, 255, 0.5);
            background: rgba(0,0,0,0.3);
            color: white;
            outline: none;
        }

        button {
            background: linear-gradient(90deg, #00f2ff, #7000ff);
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: 0.3s;
        }

        button:active { transform: scale(0.95); }

        /* سجل النشاط السفلي - للجوال والكمبيوتر */
        .log-container {
            position: absolute;
            bottom: 20px;
            left: 10px;
            right: 10px;
            max-width: 400px;
            max-height: 150px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
            font-size: 11px;
            pointer-events: auto;
            border-right: 3px solid var(--primary-neon);
        }

        /* تنسيق النقاط على الخريطة */
        .pulse-icon {
            background: var(--primary-neon);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-neon);
        }

        /* الاستعلامات البرمجية للجوال (Responsive) */
        @media (max-width: 600px) {
            .main-panel { grid-template-columns: 1fr; }
            .header-ui { top: 5px; }
            .log-container { width: calc(100% - 20px); bottom: 10px; }
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="header-ui">
    <div class="main-panel">
        <input type="number" id="senderID" placeholder="ID المرسل">
        <input type="number" id="receiverID" placeholder="ID المستقبل">
        <input type="text" id="message" placeholder="نص الرسالة...">
        <button onclick="sendData()">تشفير وإرسال</button>
    </div>
</div>

<div class="log-container" id="log">
    <div style="color:var(--primary-neon)">> نظام التشغيل جاهز...</div>
</div>

<script>
    // إعداد الخريطة مع تعطيل الـ Zoom بالإصبع لمنع تداخل الواجهة في الجوال
    const map = L.map('map', { 
        zoomControl: false,
        attributionControl: false 
    }).setView([20, 10], 2);

    // استخدام خرائط CartoDB Dark (بدون مفتاح API لسهولة الاستخدام)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const users = {
        "1": { name: "ينبع", coords: [24.0889, 38.0618] },
        "2": { name: "لندن", coords: [51.5074, -0.1278] },
        "3": { name: "نيويورك", coords: [40.7128, -74.0060] },
        "4": { name: "طوكيو", coords: [35.6762, 139.6503] },
        "5": { name: "سيدني", coords: [-33.8688, 151.2093] }
    };

    // رسم المواقع
    Object.values(users).forEach(u => {
        L.circleMarker(u.coords, {
            radius: 5,
            color: '#00f2ff',
            fillOpacity: 1
        }).addTo(map);
    });

    function addLog(text) {
        const log = document.getElementById('log');
        log.innerHTML += `<div>> ${text}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function sendData() {
        const s = document.getElementById('senderID').value;
        const r = document.getElementById('receiverID').value;
        const m = document.getElementById('message').value || "Data Packet";

        if(!users[s] || !users[r]) {
            addLog("<span style='color:red'>خطأ: ID غير معروف</span>");
            return;
        }

        const start = users[s].coords;
        const end = users[r].coords;

        addLog(`إرسال من ${users[s].name} إلى ${users[r].name}...`);

        // تأثير الخط المتحرك متوافق مع كافة المتصفحات
        const line = L.polyline([start, start], {
            color: '#00f2ff',
            weight: 2,
            dashArray: '5, 5',
            opacity: 0.6
        }).addTo(map);

        let progress = 0;
        const step = 0.02;

        function animate() {
            progress += step;
            if (progress <= 1) {
                const currentLat = start[0] + (end[0] - start[0]) * progress;
                const currentLng = start[1] + (end[1] - start[1]) * progress;
                line.setLatLngs([start, [currentLat, currentLng]]);
                requestAnimationFrame(animate);
            } else {
                line.setStyle({color: '#7000ff', opacity: 1});
                addLog(`وصلت: <span style="color:#00f2ff">${m}</span>`);
                setTimeout(() => map.removeLayer(line), 3000);
            }
        }
        animate();
    }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QB2A | HUMAN REVOLUTION</title>
    <style>
        :root { --neon-blue: #00f2ff; --neon-red: #ff0044; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; touch-action: none; font-family: sans-serif; }
        canvas { display: block; }

        /* واجهة البيانات (HUD) */
        #hud {
            position: absolute; top: 20px; left: 20px; color: var(--neon-blue);
            pointer-events: none; z-index: 10; text-shadow: 0 0 5px #000;
        }
        .hp-bar { width: 200px; height: 10px; background: #333; border: 1px solid var(--neon-blue); margin-top: 5px; }
        #hp-fill { width: 100%; height: 100%; background: var(--neon-blue); transition: 0.2s; }

        /* أزرار الجوال */
        .mobile-controls {
            position: absolute; bottom: 30px; width: 100%; display: flex;
            justify-content: space-between; padding: 0 30px; box-sizing: border-box;
            z-index: 20; display: none; /* تظهر فقط للجوال */
        }
        .btn-circle {
            width: 70px; height: 70px; background: rgba(0, 242, 255, 0.2);
            border: 2px solid var(--neon-blue); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; user-select: none;
        }
        .fire-btn { border-color: var(--neon-red); background: rgba(255, 0, 68, 0.2); width: 90px; height: 90px; }
    </style>
</head>
<body>

    <div id="hud">
        <div>المجند: فارس (QB2A-UNIT)</div>
        <div id="score">الذكاء المصفي: 0</div>
        <div class="hp-bar"><div id="hp-fill"></div></div>
    </div>

    <div class="mobile-controls" id="mobile-ui">
        <div id="joystick-zone" style="width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%;">
            </div>
        <div class="btn-circle fire-btn" id="fire-btn">FIRE</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // إعدادات اللعبة
        let score = 0;
        let health = 100;
        let isMobile = ('ontouchstart' in window);
        if(isMobile) document.getElementById('mobile-ui').style.display = 'flex';

        const player = {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            size: 15,
            color: "#00f2ff",
            speed: 4,
            bullets: []
        };

        let enemies = [];
        const keys = {};

        // تشغيل المحرك
        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            spawnEnemy();
            animate();
        }

        // إطلاق النار
        function shoot(targetX, targetY) {
            const angle = Math.atan2(targetY - player.y, targetX - player.x);
            player.bullets.push({
                x: player.x, y: player.y,
                vx: Math.cos(angle) * 7, vy: Math.sin(angle) * 7
            });
        }

        // إنشاء أعداء (الذكاء الاصطناعي)
        function spawnEnemy() {
            setInterval(() => {
                if(enemies.length < 10) {
                    const side = Math.floor(Math.random() * 4);
                    let x, y;
                    if(side === 0) { x = Math.random() * canvas.width; y = -20; }
                    else if(side === 1) { x = Math.random() * canvas.width; y = canvas.height + 20; }
                    else if(side === 2) { x = -20; y = Math.random() * canvas.height; }
                    else { x = canvas.width + 20; y = Math.random() * canvas.height; }
                    enemies.push({ x, y, size: 12, speed: 1.5 + Math.random() });
                }
            }, 2000);
        }

        // التحكم
        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
        window.addEventListener('mousedown', e => shoot(e.clientX, e.clientY));
        document.getElementById('fire-btn').addEventListener('touchstart', (e) => {
            // إطلاق نار تلقائي للأمام عند ضغط زر الجوال
            shoot(player.x, player.y - 100);
        });

        function update() {
            // حركة اللاعب
            if (keys['w'] || keys['arrowup']) player.y -= player.speed;
            if (keys['s'] || keys['arrowdown']) player.y += player.speed;
            if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
            if (keys['d'] || keys['arrowright']) player.x += player.speed;

            // تحديث الرصاص
            player.bullets.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy;
                if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) player.bullets.splice(i, 1);
            });

            // تحديث الأعداء (مطاردة اللاعب)
            enemies.forEach((en, i) => {
                const angle = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(angle) * en.speed;
                en.y += Math.sin(angle) * en.speed;

                // تصادم الرصاص مع العدو
                player.bullets.forEach((b, bi) => {
                    const dist = Math.hypot(b.x - en.x, b.y - en.y);
                    if(dist < en.size + 5) {
                        enemies.splice(i, 1);
                        player.bullets.splice(bi, 1);
                        score += 10;
                        document.getElementById('score').innerText = `الذكاء المصفي: ${score}`;
                    }
                });

                // تصادم العدو مع اللاعب
                const distToPlayer = Math.hypot(player.x - en.x, player.y - en.y);
                if(distToPlayer < player.size + en.size) {
                    health -= 0.5;
                    document.getElementById('hp-fill').style.width = health + "%";
                    if(health <= 0) alert("GAME OVER - AI RECLAIMED THE SYSTEM");
                }
            });
        }

        function draw() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.2)"; // تأثير التذيل (Motion Blur)
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // رسم اللاعب
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 10; ctx.shadowColor = player.color;
            ctx.beginPath(); ctx.arc(player.x, player.y, player.size, 0, Math.PI*2); ctx.fill();

            // رسم الرصاص
            ctx.fillStyle = "#fff";
            player.bullets.forEach(b => {
                ctx.beginPath(); ctx.arc(b.x, b.y, 3, 0, Math.PI*2); ctx.fill();
            });

            // رسم الأعداء
            ctx.fillStyle = "#ff0044"; ctx.shadowColor = "#ff0044";
            enemies.forEach(en => {
                ctx.beginPath(); ctx.arc(en.x, en.y, en.size, 0, Math.PI*2); ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Cyber Globe 3D</title>
    
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />

    <style>
        :root {
            --neon: #00f2ff;
            --purple: #7000ff;
            --bg: #010508;
            --glass: rgba(6, 11, 19, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; overflow: hidden; }

        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* واجهة المستخدم العلوية */
        .header-interface {
            position: absolute;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 90%;
            max-width: 850px;
            pointer-events: none;
        }

        .control-grid {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 242, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            pointer-events: auto;
            display: flex;
            gap: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        input, button {
            background: rgba(0,0,0,0.6);
            border: 1px solid var(--neon);
            color: var(--neon);
            padding: 12px;
            border-radius: 6px;
            outline: none;
            font-size: 13px;
            flex: 1;
        }

        button {
            background: linear-gradient(45deg, var(--neon), var(--purple));
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            max-width: 150px;
        }

        button:hover { filter: brightness(1.2); box-shadow: 0 0 15px var(--neon); }

        /* سجل النشاط الجانبي */
        .terminal-log {
            position: absolute;
            bottom: 25px; right: 20px;
            width: 260px;
            background: var(--glass);
            border-right: 4px solid var(--neon);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            z-index: 10;
            max-height: 150px;
            overflow-y: auto;
        }

        .marker-point {
            width: 10px; height: 10px;
            background: var(--neon);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--neon);
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="header-interface">
    <div class="control-grid">
        <input type="number" id="fromID" placeholder="ID المرسل">
        <input type="number" id="toID" placeholder="ID المستقبل">
        <input type="text" id="msgText" placeholder="أدخل البيانات المراد تشفيرها...">
        <button onclick="startTransmission()">نقل البيانات</button>
    </div>
</div>

<div class="terminal-log" id="terminal">> النظام الكروي متصل...</div>

<script>
    // تهيئة الكرة الأرضية الحقيقية (Globe)
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        center: [38.06, 24.08], // البداية من موقعك (ينبع)
        zoom: 2,
        pitch: 45,
        antialias: true
    });

    // تفعيل وضع الكرة الأرضية الحقيقي
    map.on('style.load', () => {
        map.setProjection({ type: 'globe' });
    });

    const users = {
        "1": { name: "ينبع (أنت)", coords: [38.0618, 24.0889] },
        "2": { name: "لندن", coords: [-0.1278, 51.5074] },
        "3": { name: "نيويورك", coords: [-74.0060, 40.7128] },
        "4": { name: "طوكيو", coords: [139.6503, 35.6762] },
        "5": { name: "باريس", coords: [2.3522, 48.8566] }
    };

    // وضع نقاط المستخدمين
    Object.values(users).forEach(u => {
        const el = document.createElement('div');
        el.className = 'marker-point';
        new maplibregl.Marker(el).setLngLat(u.coords).addTo(map);
    });

    function log(t) {
        const term = document.getElementById('terminal');
        term.innerHTML += `<div>> ${t}</div>`;
        term.scrollTop = term.scrollHeight;
    }

    function startTransmission() {
        const sID = document.getElementById('fromID').value;
        const rID = document.getElementById('toID').value;
        const msg = document.getElementById('msgText').value || "Encrypted_File";

        if(!users[sID] || !users[rID]) {
            log("<span style='color:#ff4d4d'>خطأ: ID غير صالح</span>");
            return;
        }

        const start = users[sID].coords;
        const end = users[rID].coords;

        log(`بدء الاتصال بين ${users[sID].name} و ${users[rID].name}`);

        // تحريك الكاميرا في فضاء الكرة الأرضية
        map.flyTo({ center: start, zoom: 3, speed: 1, curve: 1.5 });

        // إضافة مصدر الخط
        const lineId = 'route-' + Date.now();
        map.addSource(lineId, {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'geometry': { 'type': 'LineString', 'coordinates': [start, start] }
            }
        });

        map.addLayer({
            'id': lineId,
            'type': 'line',
            'source': lineId,
            'paint': {
                'line-color': '#00f2ff',
                'line-width': 2.5,
                'line-dasharray': [2, 1]
            }
        });

        let progress = 0;
        function animateLine() {
            progress += 0.015;
            if (progress <= 1) {
                const lng = start[0] + (end[0] - start[0]) * progress;
                const lat = start[1] + (end[1] - start[1]) * progress;
                
                map.getSource(lineId).setData({
                    'type': 'Feature',
                    'geometry': { 'type': 'LineString', 'coordinates': [start, [lng, lat]] }
                });
                requestAnimationFrame(animateLine);
            } else {
                log(`تم استلام: <span style="color:#00f2ff">${msg}</span>`);
                map.setPaintProperty(lineId, 'line-color', '#7000ff');
                map.flyTo({ center: end, zoom: 3, duration: 2000 });
            }
        }
        animateLine();
    }

    // إضافة دوران بسيط للكرة عند عدم التفاعل
    let isSpinning = true;
    function spinGlobe() {
        if (isSpinning) {
            const center = map.getCenter();
            center.lng += 0.1;
            map.setCenter(center);
            requestAnimationFrame(spinGlobe);
        }
    }
    spinGlobe();
    map.on('mousedown', () => isSpinning = false);
</script>

</body>
</html>

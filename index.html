<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خريطة إرسال البيانات العالمية</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: sans-serif; background: #1a1a1a; color: white; }
        #map { height: 70vh; width: 100%; background: #0b141a; }
        .controls { padding: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; background: #222; }
        input { padding: 10px; border-radius: 5px; border: none; width: 150px; }
        button { padding: 10px 20px; border-radius: 5px; border: none; background: #2ecc71; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #27ae60; }
        .status { text-align: center; padding: 10px; color: #f1c40f; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="controls">
    <input type="text" id="senderID" placeholder="ID المرسل (مثلاً: 1)">
    <input type="text" id="receiverID" placeholder="ID المستقبل (مثلاً: 2)">
    <input type="text" id="message" placeholder="اكتب رسالتك هنا...">
    <button onclick="sendData()">إرسال البيانات</button>
</div>
<div id="status" class="status">جاهز للإرسال...</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // إعداد الخريطة بتصميم ليلي
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // قاعدة بيانات وهمية لمواقع المستخدمين بناءً على الـ ID
    const users = {
        "1": { name: "فارس", coords: [24.0889, 38.0618] }, // ينبع
        "2": { name: "لندن", coords: [51.5074, -0.1278] },
        "3": { name: "نيويورك", coords: [40.7128, -74.0060] },
        "4": { name: "طوكيو", coords: [35.6762, 139.6503] },
        "5": { name: "سيدني", coords: [-33.8688, 151.2093] }
    };

    // إضافة علامات للمستخدمين على الخريطة
    Object.keys(users).forEach(id => {
        L.circleMarker(users[id].coords, {
            color: '#3498db',
            radius: 8,
            fillOpacity: 0.8
        }).addTo(map).bindPopup(`ID: ${id} - ${users[id].name}`);
    });

    function sendData() {
        const sID = document.getElementById('senderID').value;
        const rID = document.getElementById('receiverID').value;
        const msg = document.getElementById('message').value;

        if (!users[sID] || !users[rID]) {
            alert("يرجى إدخال ID صحيح (من 1 إلى 5)");
            return;
        }

        const start = users[sID].coords;
        const end = users[rID].coords;

        // رسم الخط الأساسي (باهت)
        const line = L.polyline([start, end], {color: '#444', weight: 2, dashArray: '5, 10'}).addTo(map);

        // إنشاء تأثير "النبضة" أو تلوين الخط المتحرك
        let count = 0;
        const statusDiv = document.getElementById('status');
        statusDiv.innerText = `جاري إرسال: "${msg}" من ${users[sID].name} إلى ${users[rID].name}...`;

        // مصفوفة النقاط للتحريك
        const animatedLine = L.polyline([start, start], {color: '#2ecc71', weight: 4}).addTo(map);
        
        let progress = 0;
        const interval = setInterval(() => {
            progress += 0.02; // سرعة الحركة
            if (progress >= 1) {
                clearInterval(interval);
                animatedLine.setLatLngs([start, end]);
                statusDiv.innerText = "تم وصول الرسالة بنجاح! ✅";
                setTimeout(() => {
                    map.removeLayer(animatedLine);
                    map.removeLayer(line);
                }, 2000);
            } else {
                const currentLat = start[0] + (end[0] - start[0]) * progress;
                const currentLng = start[1] + (end[1] - start[1]) * progress;
                animatedLine.setLatLngs([start, [currentLat, currentLng]]);
            }
        }, 20);
    }
</script>

</body>
</html>
